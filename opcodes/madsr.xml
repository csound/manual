
<refentry id="madsr">
<indexterm id="IndexMadsr"><primary>madsr</primary></indexterm>
  <refentryinfo><title>Signal Generators:Envelope Generators</title></refentryinfo>
  <refmeta>
    <refentrytitle>madsr</refentrytitle>
  </refmeta>

  <refnamediv>
    <refname>madsr</refname>
    <refpurpose>
      Calculates the classical ADSR envelope using the <emphasis>linsegr</emphasis> mechanism.
    </refpurpose>
  </refnamediv>

  <refsect1>
    <title>Description</title>
    <para>
      Calculates the classical ADSR envelope using the <link linkend="linsegr"><citetitle>linsegr</citetitle></link> mechanism.
   </para>
  </refsect1>

  <refsect1>
    <title>Syntax</title>
    <synopsis>ares <command>madsr</command> iatt, idec, islev, irel [, idel] [, ireltim]</synopsis>

    <synopsis>kres <command>madsr</command> iatt, idec, islev, irel [, idel] [, ireltim]</synopsis>
  </refsect1>

  <refsect1>
    <title>Initialization</title>
    <para>
      <emphasis>iatt</emphasis> -- duration of attack phase
    </para>

    <para>
      <emphasis>idec</emphasis> -- duration of decay
    </para>

    <para>
      <emphasis>islev</emphasis> -- level for sustain phase
    </para>

    <para>
      <emphasis>irel</emphasis> -- duration of release phase. 
    </para>

    <para>
      <emphasis>idel</emphasis> -- period of zero before the envelope starts
    </para>

    <para>
      <emphasis>ireltim</emphasis> (optional, default=-1) -- Control release time after receiving a MIDI noteoff event. If less than zero, the longest release time given in the current instrument is used. If zero or more, the given value will be used for release time. Its default value is -1. (New in Csound 3.59 - not yet properly tested)
    </para>

    <para>
      Please note that the release time was restricted to 32767/<link
      linkend="kr"><citetitle>kr</citetitle></link> seconds in
      versions prior to 5.00; since then it has been
      (2<superscript>31</superscript>-1)/kr.
    </para>
  </refsect1>

  <refsect1>
    <title>Performance</title>
    <para>
      The envelope is in the range 0 to 1 and may need to be scaled further. The envelope may be described as:

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/adsr.png" format="PNG"/>
        </imageobject>

        <textobject>
          <phrase>Picture of an ADSR envelope.</phrase>
        </textobject>
        <caption>
          <para>Picture of an ADSR envelope.</para>
        </caption>
      </mediaobject>
    </para>

    <para>
      The length of the sustain is calculated from the length of the note. This means <link linkend="adsr"><citetitle>adsr</citetitle></link> is not suitable for use with MIDI events. The opcode <emphasis>madsr</emphasis> uses the <link linkend="linsegr"><citetitle>linsegr</citetitle></link> mechanism, and so can be used in MIDI applications.
    </para>
    <para>
      You can use other pre-made envelopes which start a release segment upon receiving a note off message, like <link linkend="linsegr"><citetitle>linsegr</citetitle></link> and <link linkend="expsegr"><citetitle>expsegr</citetitle></link>, or you can construct more complex envelopes using <link linkend="xtratim"><citetitle>xtratim</citetitle></link> and <link linkend="release"><citetitle>release</citetitle></link>. Note that you don't need to use <link linkend="xtratim"><citetitle>xtratim</citetitle></link> if you are using <emphasis>madsr</emphasis>, since the time is extended automatically.
    </para>
    <note>
      <para> Times for <emphasis>iatt</emphasis>, <emphasis>idec</emphasis> and <emphasis>irel</emphasis> cannot be 0. If 0 is used, no envelope is generated. Use a very small value like 0.0001 if you need an instantaneous attack, decay or release.
      </para>
    </note>
  </refsect1>

  <refsect1>
    <title>Examples</title>
    <para>
      Here is an example of the madsr opcode. It uses the file <ulink url="examples/madsr.csd"><citetitle>madsr.csd</citetitle></ulink>.

      <example>
        <title>Example of the madsr opcode.</title>
        <para>See the sections <link linkend="UsingRealTime"><citetitle>Real-time Audio</citetitle></link> and <link linkend="CommandFlags"><citetitle>Command Line Flags</citetitle></link> for more information on using command line flags.</para>
          <xi:include href="examples-xml/madsr.csd.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
      </example>

      Here is another example of the madsr opcode, using midi input. It uses the file <ulink url="examples/madsr-2.csd"><citetitle>madsr-2.csd</citetitle></ulink>.

      <example>
        <title>second example of the madsr opcode.</title>
	  <xi:include href="examples-xml/madsr-2.csd.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
      </example>
     </para>
  </refsect1>

  <refsect1>
    <title>See Also</title>
    <para>
      <link linkend="expsegr"><citetitle>linsegr</citetitle></link>,
      <link linkend="linenr"><citetitle>expsegr</citetitle></link>,
      <link linkend="envlpxr"><citetitle>envlpxr</citetitle></link>,
      <link linkend="mxadsr"><citetitle>mxadsr</citetitle></link>,
      <link linkend="adsr"><citetitle>madsr</citetitle></link>,
      <link linkend="xadsr"><citetitle>xadsr</citetitle></link>
      <link linkend="expon"><citetitle>expon</citetitle></link>,
      <link linkend="expseg"><citetitle>expseg</citetitle></link>,
      <link linkend="expsega"><citetitle>expsega</citetitle></link>
      <link linkend="line"><citetitle>line</citetitle></link>,
      <link linkend="linseg"><citetitle>linseg</citetitle></link>,
      <link linkend="xtratim"><citetitle>xtratim</citetitle></link>
    </para>
  </refsect1>

  <refsect1>
    <title>Credits</title>
    <para>Author: &namejohn;</para>
    <para>November 2002. Thanks to &namerasmus;, added documentation for the <emphasis>ireltim</emphasis> parameter.</para>
    <para>December 2002. Thanks to Iain McCurdy, added an example.</para>
    <para>December 2002. Thanks to &nameistvan;, added documentation about the maximum release time.</para>
    <para>New in Csound version 3.49.</para>
  </refsect1>
</refentry>
